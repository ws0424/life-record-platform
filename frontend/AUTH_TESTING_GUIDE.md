# 🧪 认证功能测试指南

**测试时间**: 2026-02-10  
**测试范围**: 注册、登录、忘记密码

---

## 🚀 快速开始

### 前置条件

确保以下服务正在运行：

```bash
# 1. 检查后端服务
curl http://localhost:8000/health
# 应返回: {"status":"healthy"}

# 2. 检查前端服务
curl http://localhost:3001
# 应返回 HTML 页面

# 3. 检查数据库
docker ps | grep postgres
docker ps | grep redis
```

---

## 📋 测试用例

### 测试 1: 用户注册流程 ✅

#### 步骤

1. **访问注册页面**
   ```
   http://localhost:3001/register
   ```

2. **填写邮箱并发送验证码**
   - 邮箱: `test@example.com`
   - 点击"发送验证码"按钮
   - 等待 Toast 提示"验证码已发送到您的邮箱"

3. **检查邮箱**
   - 打开邮箱查看验证码
   - 验证码格式：6位数字
   - 有效期：5分钟

4. **填写完整注册信息**
   - 验证码: `123456`（从邮箱获取）
   - 用户名: `测试用户`
   - 密码: `test123`（必须包含字母和数字）
   - 确认密码: `test123`

5. **提交注册**
   - 点击"注册"按钮
   - 等待 Toast 提示"注册成功！"
   - 自动跳转到首页

#### 预期结果

- ✅ 验证码发送成功
- ✅ 注册成功
- ✅ 自动登录
- ✅ 跳转到首页
- ✅ Token 已保存到 localStorage

#### 验证方法

```javascript
// 打开浏览器控制台
localStorage.getItem('access_token')  // 应该有值
localStorage.getItem('refresh_token') // 应该有值
```

---

### 测试 2: 用户登录流程 ✅

#### 步骤

1. **访问登录页面**
   ```
   http://localhost:3001/login
   ```

2. **填写登录信息**
   - 邮箱: `test@example.com`
   - 密码: `test123`
   - 勾选"记住我"（可选）

3. **提交登录**
   - 点击"登录"按钮
   - 等待 Toast 提示"登录成功！"
   - 自动跳转到首页

#### 预期结果

- ✅ 登录成功
- ✅ Token 已保存
- ✅ 用户信息已保存
- ✅ 跳转到首页

#### 错误测试

**测试错误邮箱**:
- 邮箱: `wrong@example.com`
- 密码: `test123`
- 预期: Toast 提示"邮箱或密码错误"

**测试错误密码**:
- 邮箱: `test@example.com`
- 密码: `wrongpassword`
- 预期: Toast 提示"邮箱或密码错误"

---

### 测试 3: 忘记密码流程 ✅

#### 步骤

1. **访问忘记密码页面**
   ```
   http://localhost:3001/forgot-password
   ```

2. **输入邮箱并发送验证码**
   - 邮箱: `test@example.com`
   - 点击"发送验证码"按钮
   - 等待 Toast 提示"验证码已发送到您的邮箱"

3. **填写重置信息**
   - 验证码: `123456`（从邮箱获取）
   - 新密码: `newpass123`
   - 确认新密码: `newpass123`

4. **提交重置**
   - 点击"重置密码"按钮
   - 等待 Toast 提示"密码重置成功！"
   - 自动跳转到登录页

5. **使用新密码登录**
   - 邮箱: `test@example.com`
   - 密码: `newpass123`
   - 验证是否能成功登录

#### 预期结果

- ✅ 验证码发送成功
- ✅ 密码重置成功
- ✅ 跳转到登录页
- ✅ 新密码可以登录

---

### 测试 4: 验证码倒计时 ✅

#### 步骤

1. 在注册或忘记密码页面发送验证码
2. 观察"发送验证码"按钮变化

#### 预期结果

- ✅ 按钮文字变为"60秒后重试"
- ✅ 倒计时从 60 递减到 0
- ✅ 倒计时期间按钮禁用
- ✅ 倒计时结束后按钮恢复可用

---

### 测试 5: 表单验证 ✅

#### 邮箱验证

**无效邮箱格式**:
- 输入: `invalid-email`
- 预期: Toast 提示"请输入正确的邮箱格式"

**空邮箱**:
- 输入: 空
- 预期: 浏览器原生提示"请填写此字段"

#### 密码验证

**密码过短**:
- 输入: `abc12`（5位）
- 预期: Toast 提示"密码长度必须在6-20位之间"

**密码过长**:
- 输入: `abcdefghij1234567890123`（23位）
- 预期: Toast 提示"密码长度必须在6-20位之间"

**密码不包含字母**:
- 输入: `123456`
- 预期: Toast 提示"密码必须包含字母和数字"

**密码不包含数字**:
- 输入: `abcdef`
- 预期: Toast 提示"密码必须包含字母和数字"

**密码不一致**:
- 密码: `test123`
- 确认密码: `test456`
- 预期: Toast 提示"两次输入的密码不一致"

#### 用户名验证

**用户名过短**:
- 输入: `a`（1个字符）
- 预期: 浏览器原生提示

**用户名过长**:
- 输入: 超过20个字符
- 预期: 输入框限制最大长度

---

### 测试 6: Toast 提示 ✅

#### 成功提示（绿色）

- 注册成功
- 登录成功
- 验证码发送成功
- 密码重置成功

#### 错误提示（红色）

- 邮箱格式错误
- 密码验证失败
- 验证码错误
- 登录失败

#### 自动关闭

- Toast 应在 3 秒后自动关闭
- 可以手动点击关闭按钮

---

### 测试 7: Token 自动刷新 ✅

#### 步骤

1. 登录成功后，等待 Token 过期（1小时）
2. 发起任何需要认证的请求
3. 观察网络请求

#### 预期结果

- ✅ 收到 401 错误
- ✅ 自动调用刷新 Token 接口
- ✅ 使用新 Token 重新发起请求
- ✅ 请求成功

#### 刷新失败测试

1. 手动删除 refresh_token
   ```javascript
   localStorage.removeItem('refresh_token')
   ```
2. 发起需要认证的请求
3. 预期: 自动跳转到登录页

---

### 测试 8: 登出功能 ✅

#### 步骤

1. 登录成功后
2. 打开浏览器控制台
3. 执行登出
   ```javascript
   // 方法1: 使用 authStore
   const { logout } = useAuthStore.getState();
   logout();
   
   // 方法2: 手动清除
   localStorage.clear();
   ```

#### 预期结果

- ✅ Token 被清除
- ✅ 用户信息被清除
- ✅ 跳转到登录页

---

## 🐛 常见问题排查

### 问题 1: 验证码收不到

**排查步骤**:

1. 检查后端日志
   ```bash
   tail -f backend/backend.log
   ```

2. 检查邮件配置
   ```bash
   cat backend/.env | grep MAIL
   ```

3. 测试邮件服务
   ```bash
   # 访问 Swagger 文档测试
   http://localhost:8000/docs
   ```

### 问题 2: API 请求失败

**排查步骤**:

1. 检查后端服务
   ```bash
   curl http://localhost:8000/health
   ```

2. 检查网络请求
   - 打开浏览器开发者工具
   - 切换到 Network 标签
   - 查看请求详情

3. 检查 CORS 配置
   ```bash
   # 后端配置
   cat backend/.env | grep CORS
   ```

### 问题 3: Token 无效

**排查步骤**:

1. 检查 Token 是否存在
   ```javascript
   localStorage.getItem('access_token')
   ```

2. 检查 Token 格式
   - Token 应该是 JWT 格式
   - 可以在 jwt.io 解码查看

3. 重新登录获取新 Token

### 问题 4: 页面跳转失败

**排查步骤**:

1. 检查浏览器控制台错误
2. 检查路由配置
3. 清除浏览器缓存

---

## 📊 测试结果记录

### 测试环境

- 前端地址: http://localhost:3001
- 后端地址: http://localhost:8000
- 数据库: PostgreSQL 15
- 缓存: Redis 7

### 测试结果

| 测试用例 | 状态 | 备注 |
|---------|------|------|
| 用户注册 | ⏳ 待测试 | - |
| 用户登录 | ⏳ 待测试 | - |
| 忘记密码 | ⏳ 待测试 | - |
| 验证码倒计时 | ⏳ 待测试 | - |
| 表单验证 | ⏳ 待测试 | - |
| Toast 提示 | ⏳ 待测试 | - |
| Token 刷新 | ⏳ 待测试 | - |
| 登出功能 | ⏳ 待测试 | - |

---

## 🎯 测试检查清单

### 功能测试

- [ ] 注册流程完整
- [ ] 登录流程完整
- [ ] 忘记密码流程完整
- [ ] 验证码发送成功
- [ ] 验证码倒计时正常
- [ ] Token 保存成功
- [ ] 自动跳转正常

### 验证测试

- [ ] 邮箱格式验证
- [ ] 密码强度验证
- [ ] 用户名长度验证
- [ ] 密码一致性验证
- [ ] 验证码格式验证

### UI/UX 测试

- [ ] Toast 提示显示正常
- [ ] 加载状态显示正常
- [ ] 按钮禁用状态正常
- [ ] 表单输入体验良好
- [ ] 响应式布局正常

### 安全测试

- [ ] Token 安全存储
- [ ] 密码不明文传输
- [ ] HTTPS 传输（生产环境）
- [ ] XSS 防护
- [ ] CSRF 防护

---

## 📝 测试报告模板

```markdown
## 测试报告

**测试人员**: [姓名]
**测试时间**: [日期]
**测试环境**: 开发环境

### 测试结果

- 通过: X 个
- 失败: X 个
- 阻塞: X 个

### 发现的问题

1. [问题描述]
   - 严重程度: 高/中/低
   - 复现步骤: ...
   - 预期结果: ...
   - 实际结果: ...

### 建议

1. [改进建议]
```

---

## 🚀 下一步

完成测试后：

1. **修复发现的问题**
2. **优化用户体验**
3. **添加更多测试用例**
4. **准备上线部署**

---

**文档更新时间**: 2026-02-10  
**测试状态**: ⏳ 待开始

